#set ($journalArticleService = $serviceLocator.findService('com.liferay.portlet.journal.service.JournalArticleLocalService'))
#set($ddmService=$serviceLocator.findService('com.liferay.portlet.dynamicdatamapping.service.DDMStructureLocalService'))
#set($structId=$getterUtil.getLong($portletPreferences.get("anyClassTypeJournalArticleAssetRendererFactory").get(0)))
#set($structKey=$ddmService.getStructure($structId).getStructureKey())
#set ($groupId = $getterUtil.getLong($themeDisplay.getLayout().getGroupId()))
#set ($languageId = $locale)


#set($date=$dateTool.getDate())
#set($requestx=$themeDisplay.getRequest())
#set($artID=$requestx.getParameter("artID"))
#set($month=$requestx.getParameter("month"))
#set($year=$requestx.getParameter("year"))
#set($hasFull=$validator.isNotNull($artID))

#if($validator.isNotNull($month))
    #set($datex="${month}-${year}")
#else
    #set($datex=$dateTool.format("MM-yyyy", $date))
    #set($month=$dateTool.format("MM", $date))
    #set($year=$dateTool.format("yyyy", $date))
#end

## Get all of the articles
#set ($obcClass = $portal.getClass().forName("com.liferay.portlet.journal.util.comparator.ArticleCreateDateComparator"))
#set ($booleanType = $portal.getClass().forName('java.lang.Boolean'))
#set ($obcConstructor = $obcClass.getConstructor($booleanType.getField('TYPE').staticValue))
#set ($obc = $obcConstructor.newInstance(false))
#set ($articleHits = $journalArticleService.getStructureArticles($groupId, $structKey, -1, -1, $obc))

## Get full article
#set($fullx={})
#if($hasFull)
    #set ($articlex = $journalArticleService.getArticle($groupId,$artID))

        #if($validator.isNotNull($articlex))
            #set($fullx.render=1)
            #set( $document = $saxReaderUtil.read($articlex.getContent()) )
            #set( $root = $document.getRootElement() )
            ## iterate over noticia's flieds

            #foreach( $dynamicElement in $root.elements() )
                #set($namex=$dynamicElement.attributeValue("name"))
                #set($valx=$dynamicElement.element("dynamic-content").getText())

                #if("noti_titulo" == $namex)
                    #set($fullx.noti_titulo=$valx)
                #elseif("noti_subtitulo" == $namex)
                    #set($fullx.noti_subtitulo=$valx)
                #elseif("noti_fecha" == $namex)
                    #set($noti_fechax = $valx)
                    #set ($FechaObj = $dateUtil.newDate($getterUtil.getLong($noti_fechax)))
                    #set($fullx.noti_fecha=$dateUtil.getDate($FechaObj, "MMMM dd, yyyy", $locale))
                #elseif("noti_autor" == $namex)
                    #set($fullx.noti_autor=$valx)
                #elseif("noti_imagen" == $namex)
                    #set($fullx.noti_imagen=$valx)
                #elseif("noti_video" == $namex)
                    #set($fullx.noti_video=$valx)
                #elseif("noti_contenido"==$namex)
                    #set($fullx.noti_contenido=$valx)
                #elseif("noti_summary"==$namex)
                    #set($fullx.noti_summary=$valx)
                #end
            #end


        #else
            noticia solicitada no existe
            #set($fullx.render=0)
        #end

#else
#set($fullx.render=2)
#end

## full article render

#if($fullx.render==1)

articulo encontrado renderizando aquí, poner cards en base a articulo<br />
#metatags( $fullx.noti_titulo $fullx.noti_imagen $fullx.noti_summary)

#elseif($fullx.render==0)

no se encontró el articulo solicitado, poner cards por defecto<br />
#set($site_namex=$htmlUtil.escape($themeDisplay.getLayout().getGroup().getDescriptiveName()))
#metatags( "UCE-$site_namex" "http://aka-cdn.uce.edu.ec/ares/perseo/my_html/images/logo.png" "Omnium Potentior est Sapientia")
#else

no se solicitó ningun articulo, poner cards por defectox<br />
#set($site_namex=$htmlUtil.escape($themeDisplay.getLayout().getGroup().getDescriptiveName()))
#metatags( "UCE-$site_namex" "http://aka-cdn.uce.edu.ec/ares/perseo/my_html/images/logo.png" "Omnium Potentior est Sapientia")
#end

#if (!$articleHits.isEmpty())
	#foreach ($entry in $articleHits)

            #set($cur_artID=$entry.articleId)
            #set($isLastVersion =$journalArticleService.isLatestVersion($entry.getGroupId(), $entry.getArticleId() , $entry.getVersion() ) )
            #if($isLastVersion)

            #set( $document = $saxReaderUtil.read($entry.getContent()) )
            #set( $root = $document.getRootElement() )

            #set($isrender=1)

            ## iterate over noticia's flieds

            #foreach( $dynamicElement in $root.elements() )
                #set($namex=$dynamicElement.attributeValue("name"))
                #set($valx=$dynamicElement.element("dynamic-content").getText())

                #if("noti_titulo" == $namex)
                    #set($noti_titulo = $valx)
                #elseif("noti_subtitulo" == $namex)
                    #set($noti_subtitulo =$valx)
                #elseif("noti_fecha" == $namex)
                    #set($noti_fechax = $valx)
                    #set ($FechaObj = $dateUtil.newDate($getterUtil.getLong($noti_fechax)))
                    #set($noti_fecha1=$dateUtil.getDate($FechaObj, "MM-yyyy", $locale))
                    #set($noti_fecha=$dateUtil.getDate($FechaObj, "MMMM dd, yyyy", $locale))
                    #if($noti_fecha1!=$datex)
                        #set($isrender=0)
                        #break
                    #end
                #elseif("noti_autor" == $namex)
                    #set($noti_autor = $valx)
                #elseif("noti_imagen" == $namex)
                    #set($noti_imagen = $valx)
                #elseif("noti_video" == $namex)
                    #set($noti_video = $valx)
                #elseif("noti_contenido"==$namex)
                    #set($noti_contenido = $valx)
                #elseif("noti_summary"==$namex)
                    #set($fullx.noti_summary=$valx)
                #end
            #end ##foreach xml entry


            #if($isrender==1)
                $noti_fecha<br />
            #end
        $noti_titulo
        #end ## if last version

    #end ##foreach
#else
no articulos en este mes
#end






##macros

#macro( metatags $title $img $desc )

#set($titletag="title")
#set($imgtag="image")
#set($desctag="description")

#facetag( $titletag $title)
#facetag( $imgtag $img)
#facetag( $desctag $desc)

#twittertag( $titletag $title)
#twittertag( $imgtag $img)
#twittertag( $desctag $desc)
#end

#macro (facetag $keyx $valxx )

#set($el=$renderResponse.createElement("meta"))
#set($void=$el.setAttribute("property","og:$keyx"))
#set($void=$el.setAttribute("content",$valxx))
##set($void=$el.setTextContent(" "))
#set($void=$renderResponse.addProperty("javax.portlet.markup.head.element",$el ))

#end


#macro (twittertag $keyx $valxx )

#set($el=$renderResponse.createElement("meta"))
#set($void=$el.setAttribute("name","twitter:$keyx"))
#set($void=$el.setAttribute("content",$valxx))
##set($void=$el.setTextContent(" "))
#set($void=$renderResponse.addProperty("javax.portlet.markup.head.element",$el ))

#end